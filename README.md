# Задание #4 Развитие Publish/Subscribe. Шаблоны Post/Redirect/Get, Retry

## Постановка задачи

Заказчик хочет предоставить пользователям новый функционал: выдавать оценку вводимых текстов по некоторому критерию. 
Критерием оценки на начальном этапе является отношение количества гласных букв к количеству согласных, 
но в будущем этот функционал будет развиваться и планируется задействовать более сложные алгоритмы оценок.

## Реализация.

Работа является развитием Задания #3

Frontend по прежнему отправляет вводимый текст в *BackendApi* через вызов веб-службы. 
Компонент *BackendApi* генерирует идентификатор текста (теперь он будет называться **идентификатор контекста обработки**), помещает текст в хранилище и публикует событие  *TextCreated*, содержащее идентификатор  контекста обработки. После чего возвращает значение идентификатора в ответе на запрос.

### Frontend

*Frontend* компонент, отправив текст в *BackendApi*, перенаправляет пользователя на страницу 
просмотра оценки текста *TextDetails*, где ему отобразится результат оценивания текста. 
В параметрах адреса *TextDetails* должно передаваться значение идентификатора контекста обработки.
При загрузке страницы *TextDetails* на серверной части происходит обращение к REST-сервису компонента *BackendApi* 
для получения значения вычисленной оценки.

Подобная реализация поведения веб-приложения относится к шаблону **Post/Redirect/Get**.

### BackendApi

Добавляется метод веб-службы, принимающий в качестве параметра идентификатор контекста обработки и возвращающий 
оценку текста, полученную в результате вычислений.

Порядок обработки запроса в методе:

1. По идентификатору из хранилища извлекается результат оценивания текста.
2. Если соответствующих данных в хранилище не найдено, производится несколько попыток получения данных 
с коротким «засыпанием» между попытками.
3. При достижении максимального количества попыток или успешном получении результата в ответе за запрос 
возвращается значение оценки или код ошибки *404 Not Found*.

Модель поведения приложения, когда происходит несколько попыток доступа к ресурсу, называется **Retry**.

#### Оценка текста: TextRankCalc
Появляется новый компонент **TextRankCalc**. Компонент представляет собой консольное приложение. 
При запуске компонент начинает слушать сообщения *TextCreated* в шине сообщений.
Действия при получении сообщения *TextCreated*:
1.	По идентификатору в сообщении извлекает из Redis-хранилища соответствующий текст.
2.	Подсчитывает количество гласных и согласных букв в тексте.
3.	Подсчитывает оценку текста в виде отношения количества гласных к количеству согласных букв.
4.	В Redis- хранилище записывается полученная оценка по идентификатору контекста.

##### Замечания
Для "засыпания" процесса можно использовать метод *Thread.Sleep(ms)* или *Task.Delay(ms)* (для async методов).

